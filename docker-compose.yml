version: "3.3"

services:
  app:
    build:
      context: .
      dockerfile: docker/app/Dockerfile
    command: [python, -m, app, server, up]
    volumes:
      - .:/opt/app
    depends_on:
      - postgres
    ports:
      - 8080:8080
    environment:
      APP_DATABASE_URL: postgresql://db:password@postgres/postgres

  postgres:
    image: postgres:12-alpine
    environment:
      POSTGRES_PASSWORD: 'password'
      POSTGRES_USER: 'db'

  pgcli:
    image: daxart/pgcli:latest
    depends_on:
      - postgres
    command:
      - postgres://db:password@postgres/postgres
